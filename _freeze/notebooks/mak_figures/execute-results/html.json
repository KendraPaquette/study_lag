{
  "hash": "1d5cc170830edc254f66bc37db755145",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Make All Figures for Main Manuscript\"\nauthor: \"Kendra Wyant\"\ndate: \"2024-10-24\"\nnumber-sections: true\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\n    toc: true\n    toc-depth: 4\neditor_options: \n  chunk_output_type: console\nhtml-table-processing: none\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(source(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\"))\nsuppressPackageStartupMessages(library(tidyposterior))\nlibrary(kableExtra, exclude = \"group_rows\")\nlibrary(patchwork)\n\ntheme_set(theme_classic())\n\npath_models_lag <- format_path(str_c(\"studydata/risk/models/lag\"))\npath_shared <- format_path(\"studydata/risk/data_processed/shared\")\npath_processed <- format_path(\"studydata/risk/data_processed/lag\")\n```\n:::\n\n\n\nData for figures\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ntest_metrics_all_pp_perf <- read_csv(here::here(path_models_lag,\n                                                \"test_metrics_all_pp_perf.csv\"),\n                                     show_col_types = FALSE)\n\npp_dem <- read_csv(here::here(path_models_lag, \"pp_dem_all.csv\"),\n                            show_col_types = FALSE)\n```\n:::\n\n\n\n\n## Figure 1: Prediction Methods\n\n\n::: {#cell-fig-methods .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-methods\n#| fig-cap: \"We used all available data up until the prediction timepoint to generate features using varying scoring epochs. Prediction timepoints rolled forward hour-by-hour (Panel A). Prediction windows were 1 week wide. A prediction window started immediately after the prediction timepoint (0 lag) or was lagged by 24, 72, 168, or 336 hours (Panel B).\"\n\nknitr::include_graphics(path = here::here(\"figures/methods.png\"), error = FALSE)\n```\n\n::: {.cell-output-display}\n![We used all available data up until the prediction timepoint to generate features using varying scoring epochs. Prediction timepoints rolled forward hour-by-hour (Panel A). Prediction windows were 1 week wide. A prediction window started immediately after the prediction timepoint (0 lag) or was lagged by 24, 72, 168, or 336 hours (Panel B).](../figures/methods.png){#fig-methods width=344}\n:::\n:::\n\n\n\n\n\n\n## Figure 2: Posterior probability for auROC by model and demographic group differences\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nfig_1 <- test_metrics_all_pp_perf |>\n  mutate(model_numeric = case_when(model == \"336 lag\" ~ as.numeric(336),\n                                   model == \"168 lag\" ~ as.numeric(168),\n                                   model == \"72 lag\" ~ as.numeric(72),\n                                   model == \"24 lag\" ~ as.numeric(24),\n                                   model == \"0 lag\" ~ as.numeric(0))) |> \n  ggplot() + \n  geom_point(aes(x = model_numeric, y = pp_median), color = \"black\") +\n  geom_line(aes(x = model_numeric, y = pp_median)) +\n  geom_segment(mapping = aes(x = model_numeric, y = pp_lower, yend = pp_upper)) +\n  scale_y_continuous(\"Area Under ROC Curve\", limits = c(.50, 1.0)) +\n  scale_x_continuous(\"Model Lag (Hours)\", breaks = c(0, 24, 72, 168, 336), \n                     labels = c(\"0\", \"24\", \"72\", \"168\", \"336\")) +\n  theme_classic() +\n  theme(legend.position = \"none\",\n        panel.border = element_rect(colour = \"black\", fill = NA, linewidth = 1)) +\n  geom_hline(yintercept = 0.5, linetype = \"dashed\", color = \"black\")\n```\n:::\n\n::: {#cell-fig-1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-1\n#| fig-cap: \"Median posterior probability for area under ROC curve (auROC) and Bayesian credible interval by model. Dashed line represents a random classifier.\"\n#| fig-width: 7\n\nfig_1\n```\n\n::: {.cell-output-display}\n![Median posterior probability for area under ROC curve (auROC) and Bayesian credible interval by model. Dashed line represents a random classifier.](mak_figures_files/figure-html/fig-1-1.png){#fig-1 width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\npp_dem <- pp_dem |>\n  mutate(contrast = factor(model, levels = c(\"not white\", \n                                             \"non-hispanic white\",\n                                             \"female\",\n                                             \"male\",\n                                             \"below poverty\",\n                                             \"above poverty\"),\n                           labels = c(\"Not White vs. Non-Hispanic White\",\n                                      \"Not White vs. Non-Hispanic White\",\n                                      \"Female vs. Male\",\n                                      \"Female vs. Male\",\n                                      \"Below Poverty vs. Above Poverty\",\n                                      \"Below Poverty vs. Above Poverty\")),\n         group = factor(model, levels = c(\"non-hispanic white\",\n                                          \"not white\", \n                                          \"female\",\n                                          \"male\",\n                                          \"below poverty\",\n                                          \"above poverty\"),\n                        labels = c(\"advantaged group\", \n                                   \"disadvantaged group\",\n                                   \"disadvantaged group\",\n                                   \"advantaged group\",\n                                   \"disadvantaged group\",\n                                   \"advantaged group\"))) \n\npp_dem_a <- pp_dem |> \n  filter(contrast == \"Not White vs. Non-Hispanic White\") |> \n  ggplot() + \n  geom_point(aes(x = lag, y = pp_median, color = group)) +\n  geom_line(aes(x = lag, y = pp_median, color = group)) +\n  geom_segment(mapping = aes(x = lag, y = pp_lower, yend = pp_upper, color = group)) +\n  facet_wrap(~ contrast) +\n  scale_y_continuous(\"Area Under ROC Curve\", limits = c(.50, 1.0)) +\n  scale_x_continuous(NULL, breaks = c(0, 24, 72, 168, 336), \n                     labels = c(\"0\", \"24\", \"72\", \"168\", \"336\")) +\n  theme_classic() +\n  theme(panel.border = element_rect(colour = \"black\", fill = NA, linewidth = 1)) +\n  scale_color_manual(values = c(\"#240e31\", \"#cb6bce\")) +\n  geom_hline(yintercept = 0.5, linetype = \"dashed\", color = \"black\") +\n  labs(color = NULL)\n\npp_dem_b <- pp_dem |> \n  filter(contrast == \"Female vs. Male\") |> \n  ggplot() + \n  geom_point(aes(x = lag, y = pp_median, color = group)) +\n  geom_line(aes(x = lag, y = pp_median, color = group)) +\n  geom_segment(mapping = aes(x = lag, y = pp_lower, yend = pp_upper, color = group)) +\n  facet_wrap(~ contrast) +\n  scale_y_continuous(NULL, limits = c(.50, 1.0)) +\n  scale_x_continuous(\"Model Lag (Hours)\", breaks = c(0, 24, 72, 168, 336), \n                     labels = c(\"0\", \"24\", \"72\", \"168\", \"336\")) +\n  theme_classic() +\n  theme(panel.border = element_rect(colour = \"black\", fill = NA, linewidth = 1)) +\n  scale_color_manual(values = c(\"#240e31\", \"#cb6bce\")) +\n  geom_hline(yintercept = 0.5, linetype = \"dashed\", color = \"black\") +\n  labs(color = NULL)\n\npp_dem_c <- pp_dem |> \n  filter(contrast == \"Below Poverty vs. Above Poverty\") |> \n  ggplot() + \n  geom_point(aes(x = lag, y = pp_median, color = group)) +\n  geom_line(aes(x = lag, y = pp_median, color = group)) +\n  geom_segment(mapping = aes(x = lag, y = pp_lower, yend = pp_upper, color = group)) +\n  facet_wrap(~ contrast) +\n  scale_y_continuous(NULL, limits = c(.50, 1.0)) +\n  scale_x_continuous(NULL, breaks = c(0, 24, 72, 168, 336), \n                     labels = c(\"0\", \"24\", \"72\", \"168\", \"336\")) +\n  theme_classic() +\n  theme(panel.border = element_rect(colour = \"black\", fill = NA, linewidth = 1)) +\n  scale_color_manual(values = c(\"#240e31\", \"#cb6bce\")) +\n  geom_hline(yintercept = 0.5, linetype = \"dashed\", color = \"black\") +\n  labs(color = NULL)\n```\n:::\n\n::: {#cell-fig-2 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-2\n#| fig-cap: \"Median posterior probability for area under ROC curve (auROC) and Bayesian credible interval by model and fairness contrast Dashed line represents a random classifier.\"\n#| fig-width: 8\n#| fig-height: 6\n\npp_dem_a + pp_dem_b + pp_dem_c + plot_layout(guides = \"collect\") &\n  theme(legend.position = \"bottom\") &\n  plot_annotation(tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![Median posterior probability for area under ROC curve (auROC) and Bayesian credible interval by model and fairness contrast Dashed line represents a random classifier.](mak_figures_files/figure-html/fig-2-1.png){#fig-2 width=768}\n:::\n:::\n",
    "supporting": [
      "mak_figures_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}